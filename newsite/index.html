<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì´í”ŒìŠ¤í† ë¦¬ ìºë¦­í„° ê²€ìƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Noto Sans KR', 'Apple SD Gothic Neo', 'Dotum', 'ë‹ì›€', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .header h1:hover {
            transform: scale(1.05);
        }

        .config-btn {
            position: absolute;
            top: 0;
            right: 0;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .config-btn:hover {
            background: white;
            color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .main-layout {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .ranking-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .ranking-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .ranking-controls select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            flex: 1;
            max-width: 300px;
        }

        .ranking-controls button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .ranking-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .ranking-controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .ranking-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .ranking-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .ranking-table tr:hover {
            background: #f5f5f5;
            cursor: pointer;
        }

        .ranking-table tr:nth-child(even) {
            background: #fafafa;
        }

        .ranking-table tr:nth-child(even):hover {
            background: #f5f5f5;
        }

        .rank-number {
            font-weight: bold;
            font-size: 1.2em;
            color: #667eea;
        }

        .rank-number.top1 {
            color: #FFD700;
        }

        .rank-number.top2 {
            color: #C0C0C0;
        }

        .rank-number.top3 {
            color: #CD7F32;
        }

        .popular-searches {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .popular-searches-title {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .popular-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .popular-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .popular-tag:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .popular-tag-rank {
            font-weight: bold;
            color: #667eea;
        }

        .popular-tag:hover .popular-tag-rank {
            color: white;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .search-box button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }



        .character-info {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .character-info.active {
            display: block;
        }

        .character-info h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .character-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .character-left-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 300px;
        }

        .character-image-section {
            text-align: center;
        }

        .character-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: #f8f9fa;
        }

        .character-basic-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .character-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-item {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
        }

        .info-value {
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }

        .equipment-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }

        .equipment-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .equipment-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }

        .equipment-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .equipment-part {
            background: #667eea;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            margin-bottom: 8px;
            display: inline-block;
        }

        .equipment-image-container {
            width: 60px;
            height: 60px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .equipment-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .equipment-name {
            font-weight: bold;
            color: #333;
            font-size: 0.85em;
            margin-bottom: 8px;
            line-height: 1.3;
            min-height: 2.6em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .equipment-badges {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 8px;
        }

        .equipment-badge {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            color: #666;
        }

        .equipment-badge.starforce {
            background: #fff3cd;
            color: #856404;
            font-weight: bold;
        }

        .equipment-badge.potential {
            font-weight: bold;
        }

        .equipment-badge.potential.rare {
            background: #cfe2ff;
            color: #084298;
        }

        .equipment-badge.potential.epic {
            background: #e0cffc;
            color: #6f42c1;
        }

        .equipment-badge.potential.unique {
            background: #fff3cd;
            color: #997404;
        }

        .equipment-badge.potential.legendary {
            background: #d1e7dd;
            color: #0f5132;
        }

        .equipment-stats {
            display: none;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #c33;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: '.';
            }

            40% {
                content: '..';
            }

            60%,
            100% {
                content: '...';
            }
        }

        .loading small {
            display: block;
            margin-top: 10px;
            font-size: 0.85em;
            color: #999;
        }

        .no-equipment {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .no-ranking {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        @media (max-width: 1200px) {
            .character-layout {
                flex-direction: column;
            }

            .character-left-section {
                min-width: auto;
            }

            .equipment-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .equipment-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            }
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }

        .modal-item-image {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .modal-item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .modal-item-title {
            flex: 1;
        }

        .modal-item-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .modal-item-part {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .modal-stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .modal-stat-value {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        .modal-potential-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .modal-potential-item {
            background: #d4edda;
            padding: 10px 15px;
            border-radius: 8px;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .modal-potential-grade {
            display: inline-block;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .modal-potential-grade.rare {
            background: #0d6efd;
        }

        .modal-potential-grade.epic {
            background: #6f42c1;
        }

        .modal-potential-grade.unique {
            background: #ffc107;
            color: #333;
        }

        .modal-potential-grade.legendary {
            background: #198754;
        }

        .modal-enhancement {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .modal-enhancement-item {
            background: #fff3cd;
            padding: 12px 20px;
            border-radius: 8px;
            color: #856404;
            font-weight: bold;
            border-left: 4px solid #ffc107;
        }

        .equipment-item {
            cursor: pointer;
        }

        /* ìœ íŠœë²„ ì¶”ì²œ ìŠ¤íƒ€ì¼ */
        .youtuber-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .youtuber-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .youtuber-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .youtuber-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
        }

        .youtuber-info {
            padding: 20px;
        }

        .youtuber-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .youtuber-subscribers {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .youtuber-category {
            display: inline-block;
            background: #f0f0f0;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }

        .youtuber-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .youtuber-link {
            display: inline-block;
            background: #FF0000;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .youtuber-link:hover {
            background: #CC0000;
        }

        .category-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .category-btn:hover {
            background: #e0e0e0;
        }

        .category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .youtuber-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1 onclick="resetToHome()">ğŸ ë©”ì´í”ŒìŠ¤í† ë¦¬ ìºë¦­í„° ê²€ìƒ‰</h1>
            <button class="config-btn" onclick="goToConfig()">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('search')">ğŸ” ìºë¦­í„° ê²€ìƒ‰</div>
            <div class="tab" onclick="switchTab('ranking')">ğŸ† ìˆœìœ„</div>
            <div class="tab" onclick="switchTab('youtuber')">ğŸ“º ìœ íŠœë²„ ì¶”ì²œ</div>
        </div>

        <div class="main-layout">
            <!-- ìºë¦­í„° ê²€ìƒ‰ íƒ­ -->
            <div id="search-tab" class="tab-content active">
                <div class="search-section">
                    <h2 style="color: #667eea; margin-bottom: 20px;">ìºë¦­í„° ê²€ìƒ‰</h2>

                    <!-- ì¸ê¸° ê²€ìƒ‰ ìºë¦­í„° (ì‘ê²Œ ìƒë‹¨ì— í‘œì‹œ) -->
                    <div class="popular-searches" id="popular-searches">
                        <div class="popular-searches-title">ğŸ”¥ ì¸ê¸° ê²€ìƒ‰</div>
                        <div class="popular-tags" id="popular-tags"></div>
                    </div>

                    <div class="search-box">
                        <input type="text" id="character-name" placeholder="ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                            onkeypress="if(event.key === 'Enter') searchCharacter()">
                        <button onclick="searchCharacter()" id="search-btn">ê²€ìƒ‰</button>
                    </div>
                    <div id="character-info" class="character-info"></div>
                </div>
            </div>

            <!-- ìˆœìœ„ íƒ­ -->
            <div id="ranking-tab" class="tab-content">
                <div class="ranking-section">
                    <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ† ì „íˆ¬ë ¥ ìˆœìœ„</h2>
                    <div class="ranking-controls">
                        <select id="world-select">
                            <option value="">ì „ì²´ ì›”ë“œ</option>
                            <option value="ìŠ¤ì¹´ë‹ˆì•„">ìŠ¤ì¹´ë‹ˆì•„</option>
                            <option value="ë² ë¼">ë² ë¼</option>
                            <option value="ë£¨ë‚˜">ë£¨ë‚˜</option>
                            <option value="ì œë‹ˆìŠ¤">ì œë‹ˆìŠ¤</option>
                            <option value="í¬ë¡œì•„">í¬ë¡œì•„</option>
                            <option value="ìœ ë‹ˆì˜¨">ìœ ë‹ˆì˜¨</option>
                            <option value="ì—˜ë¦¬ì‹œì›€">ì—˜ë¦¬ì‹œì›€</option>
                            <option value="ì´ë…¸ì‹œìŠ¤">ì´ë…¸ì‹œìŠ¤</option>
                            <option value="ë ˆë“œ">ë ˆë“œ</option>
                            <option value="ì˜¤ë¡œë¼">ì˜¤ë¡œë¼</option>
                            <option value="ì•„ì¼€ì¸">ì•„ì¼€ì¸</option>
                            <option value="ë…¸ë°”">ë…¸ë°”</option>
                            <option value="ë¦¬ë¶€íŠ¸">ë¦¬ë¶€íŠ¸</option>
                            <option value="ë¦¬ë¶€íŠ¸2">ë¦¬ë¶€íŠ¸2</option>
                            <option value="ë²„ë‹">ë²„ë‹</option>
                            <option value="ë²„ë‹2">ë²„ë‹2</option>
                            <option value="ë²„ë‹3">ë²„ë‹3</option>
                        </select>
                        <button onclick="loadRanking()" id="ranking-btn">ìˆœìœ„ ì¡°íšŒ</button>
                    </div>
                    <div id="ranking-container">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            ì›”ë“œë¥¼ ì„ íƒí•˜ê³  "ìˆœìœ„ ì¡°íšŒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ìœ íŠœë²„ ì¶”ì²œ íƒ­ -->
            <div id="youtuber-tab" class="tab-content">
                <div class="search-section">
                    <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“º ë©”ì´í”Œ ìœ íŠœë²„ ì¶”ì²œ</h2>

                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <label style="font-weight: bold; color: #666;">êµ¬ë…ì ìˆ˜ í•„í„°:</label>
                            <input type="range" id="subscriber-filter" min="0" max="2000000" value="2000000"
                                step="50000" style="flex: 1;" oninput="updateSubscriberFilter(this.value)">
                            <span id="subscriber-value"
                                style="font-weight: bold; color: #667eea; min-width: 100px;">200ë§Œ ì´í•˜</span>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="filterYoutubers('all')" class="category-btn active"
                                data-category="all">ì „ì²´</button>
                            <button onclick="filterYoutubers('ì¢…í•©')" class="category-btn" data-category="ì¢…í•©">ì¢…í•©</button>
                            <button onclick="filterYoutubers('ì´ˆë³´ì')" class="category-btn"
                                data-category="ì´ˆë³´ì">ì´ˆë³´ì</button>
                            <button onclick="filterYoutubers('ê³µëµ')" class="category-btn" data-category="ê³µëµ">ê³µëµ</button>
                            <button onclick="filterYoutubers('ì¬í™”')" class="category-btn" data-category="ì¬í™”">ì¬í™”</button>
                            <button onclick="filterYoutubers('ê°•í™”')" class="category-btn" data-category="ê°•í™”">ê°•í™”</button>
                        </div>
                    </div>

                    <div id="youtuber-container" class="youtuber-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•„ì´í…œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div id="item-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        const PROXY_PORT = 8000;
        const PROXY_URL = `http://localhost:${PROXY_PORT}`;
        const DIRECT_API_BASE_URL = 'https://open.api.nexon.com';

        let USE_PROXY = true;
        let API_BASE_URL = PROXY_URL;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function () {
            checkApiKey();
            checkProxyServer();
            loadSearchRanking();
        });

        function checkApiKey() {
            const apiKey = localStorage.getItem('maplestory_api_key');
            if (!apiKey) {
                if (confirm('API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    window.location.href = 'config.html';
                }
            }
        }

        async function checkProxyServer() {
            try {
                await fetch(`${PROXY_URL}/`, { method: 'HEAD', cache: 'no-cache' });
                USE_PROXY = true;
                API_BASE_URL = PROXY_URL;
            } catch (error) {
                USE_PROXY = false;
                console.warn('í”„ë¡ì‹œ ì„œë²„ ì—°ê²° ì‹¤íŒ¨');
            }
        }

        function goToConfig() {
            window.location.href = 'config.html';
        }

        function getApiKey() {
            return localStorage.getItem('maplestory_api_key') || '';
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            if (tabName === 'search') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('search-tab').classList.add('active');
            } else if (tabName === 'ranking') {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('ranking-tab').classList.add('active');
            } else if (tabName === 'youtuber') {
                document.querySelector('.tab:nth-child(3)').classList.add('active');
                document.getElementById('youtuber-tab').classList.add('active');
                loadYoutubers(); // ìœ íŠœë²„ ë°ì´í„° ë¡œë“œ
            }
        }

        // í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° (ì œëª© í´ë¦­ ì‹œ)
        function resetToHome() {
            // ê²€ìƒ‰ íƒ­ìœ¼ë¡œ ì „í™˜
            switchTab('search');

            // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
            const infoDiv = document.getElementById('character-info');
            infoDiv.classList.remove('active');
            infoDiv.innerHTML = '';

            // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
            document.getElementById('character-name').value = '';
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ê²€ìƒ‰ íšŸìˆ˜ ì¶”ì 
        function trackSearch(characterName) {
            const searches = JSON.parse(localStorage.getItem('character_searches') || '{}');
            searches[characterName] = (searches[characterName] || 0) + 1;
            localStorage.setItem('character_searches', JSON.stringify(searches));
            loadSearchRanking();
        }

        // ê²€ìƒ‰ ìˆœìœ„ ë¡œë“œ (ìƒë‹¨ì— ì‘ê²Œ í‘œì‹œ)
        function loadSearchRanking() {
            const searches = JSON.parse(localStorage.getItem('character_searches') || '{}');
            const popularTags = document.getElementById('popular-tags');

            const sortedSearches = Object.entries(searches)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5); // ìƒìœ„ 5ê°œë§Œ í‘œì‹œ

            if (sortedSearches.length === 0) {
                popularTags.innerHTML = '<span style="color: #999; font-size: 0.85em;">ì•„ì§ ê²€ìƒ‰í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤</span>';
                return;
            }

            let html = '';
            sortedSearches.forEach(([name, count], index) => {
                const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}.`;
                html += `
                    <div class="popular-tag" onclick="searchFromRanking('${name}')">
                        <span class="popular-tag-rank">${rankEmoji}</span>
                        <span>${name}</span>
                        <span style="color: #999; font-size: 0.9em;">(${count})</span>
                    </div>
                `;
            });
            popularTags.innerHTML = html;
        }

        function searchFromRanking(characterName) {
            document.getElementById('character-name').value = characterName;
            searchCharacter();
        }

        // API í˜¸ì¶œ í•¨ìˆ˜ë“¤
        async function getCharacterOcid(characterName, apiKey) {
            const url = USE_PROXY
                ? `${API_BASE_URL}/api/maplestory/id?character_name=${encodeURIComponent(characterName)}`
                : `${DIRECT_API_BASE_URL}/maplestory/v1/id?character_name=${encodeURIComponent(characterName)}`;

            const response = await fetch(url, {
                headers: { 'x-nxopen-api-key': apiKey }
            });

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.message || `API ìš”ì²­ ì‹¤íŒ¨ (${response.status})`);
            }

            const data = await response.json();
            if (!data.ocid) throw new Error('ìºë¦­í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return data.ocid;
        }

        async function getCharacterBasicInfo(ocid, apiKey) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateString = formatDate(yesterday);

            const url = USE_PROXY
                ? `${API_BASE_URL}/api/maplestory/character/basic?ocid=${ocid}&date=${dateString}`
                : `${DIRECT_API_BASE_URL}/maplestory/v1/character/basic?ocid=${ocid}&date=${dateString}`;

            const response = await fetch(url, {
                headers: { 'x-nxopen-api-key': apiKey }
            });

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.message || `API ìš”ì²­ ì‹¤íŒ¨ (${response.status})`);
            }

            return await response.json();
        }

        async function getCharacterEquipment(ocid, apiKey) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateString = formatDate(yesterday);

            const url = USE_PROXY
                ? `${API_BASE_URL}/api/maplestory/character/item-equipment?ocid=${ocid}&date=${dateString}`
                : `${DIRECT_API_BASE_URL}/maplestory/v1/character/item-equipment?ocid=${ocid}&date=${dateString}`;

            const response = await fetch(url, {
                headers: { 'x-nxopen-api-key': apiKey }
            });

            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.message || `ì¥ë¹„ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨ (${response.status})`);
            }

            return await response.json();
        }

        // ìºë¦­í„° ìŠ¤íƒ¯ ì •ë³´ ì¡°íšŒ (ì „íˆ¬ë ¥ í¬í•¨)
        async function getCharacterStat(ocid, apiKey) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateString = formatDate(yesterday);

            try {
                const url = USE_PROXY
                    ? `${API_BASE_URL}/api/maplestory/character/stat?ocid=${ocid}&date=${dateString}`
                    : `${DIRECT_API_BASE_URL}/maplestory/v1/character/stat?ocid=${ocid}&date=${dateString}`;

                const response = await fetch(url, {
                    headers: { 'x-nxopen-api-key': apiKey }
                });

                if (response.ok) {
                    const data = await response.json();
                    return data;
                }
            } catch (error) {
                console.log('ìºë¦­í„° ìŠ¤íƒ¯ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
            return null;
        }

        // ìºë¦­í„° ì´ë¯¸ì§€ ì¡°íšŒ (ë„¥ìŠ¨ APIì—ì„œ ì œê³µí•˜ëŠ” ê²½ìš°)
        async function getCharacterImage(ocid, apiKey) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateString = formatDate(yesterday);

            try {
                const url = USE_PROXY
                    ? `${API_BASE_URL}/api/maplestory/character/basic?ocid=${ocid}&date=${dateString}`
                    : `${DIRECT_API_BASE_URL}/maplestory/v1/character/basic?ocid=${ocid}&date=${dateString}`;

                const response = await fetch(url, {
                    headers: { 'x-nxopen-api-key': apiKey }
                });

                if (response.ok) {
                    const data = await response.json();
                    // character_image í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                    return data.character_image || null;
                }
            } catch (error) {
                console.log('ìºë¦­í„° ì´ë¯¸ì§€ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
            return null;
        }

        // ì „íˆ¬ë ¥ ìˆœìœ„ ì¡°íšŒ
        async function loadRanking() {
            const apiKey = getApiKey();
            const worldName = document.getElementById('world-select').value;
            const rankingBtn = document.getElementById('ranking-btn');
            const rankingContainer = document.getElementById('ranking-container');

            if (!apiKey) {
                alert('API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'config.html';
                return;
            }

            rankingBtn.disabled = true;
            rankingBtn.textContent = 'ì¡°íšŒ ì¤‘...';
            rankingContainer.innerHTML = '<div class="loading">ìˆœìœ„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<br><small>ì „íˆ¬ë ¥ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</small></div>';

            try {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const dateString = formatDate(yesterday);

                // 1ë‹¨ê³„: ì¢…í•© ìˆœìœ„ ì¡°íšŒ (ìƒìœ„ 100ëª…)
                const url = USE_PROXY
                    ? `${API_BASE_URL}/api/maplestory/ranking/overall?date=${dateString}${worldName ? '&world_name=' + encodeURIComponent(worldName) : ''}`
                    : `${DIRECT_API_BASE_URL}/maplestory/v1/ranking/overall?date=${dateString}${worldName ? '&world_name=' + encodeURIComponent(worldName) : ''}`;

                const response = await fetch(url, {
                    headers: { 'x-nxopen-api-key': apiKey }
                });

                if (!response.ok) {
                    const error = await response.json().catch(() => ({}));
                    throw new Error(error.message || `ìˆœìœ„ ì¡°íšŒ ì‹¤íŒ¨ (${response.status})`);
                }

                const data = await response.json();
                console.log('ìˆœìœ„ API ì‘ë‹µ:', data);

                if (!data.ranking || data.ranking.length === 0) {
                    rankingContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ìˆœìœ„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                // 2ë‹¨ê³„: ìƒìœ„ 50ëª…ì˜ ì „íˆ¬ë ¥ ì •ë³´ ì¡°íšŒ
                rankingContainer.innerHTML = '<div class="loading">ì „íˆ¬ë ¥ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘<br><small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</small></div>';

                const top100 = data.ranking.slice(0, 100);
                const charactersWithPower = [];

                // ë³‘ë ¬ë¡œ ì „íˆ¬ë ¥ ì¡°íšŒ (10ê°œì”© ë°°ì¹˜ ì²˜ë¦¬)
                for (let i = 0; i < Math.min(50, top100.length); i += 10) {
                    const batch = top100.slice(i, i + 10);
                    const batchPromises = batch.map(async (char) => {
                        try {
                            // OCID ì¡°íšŒ
                            const ocidUrl = USE_PROXY
                                ? `${API_BASE_URL}/api/maplestory/id?character_name=${encodeURIComponent(char.character_name)}`
                                : `${DIRECT_API_BASE_URL}/maplestory/v1/id?character_name=${encodeURIComponent(char.character_name)}`;

                            const ocidResponse = await fetch(ocidUrl, {
                                headers: { 'x-nxopen-api-key': apiKey }
                            });

                            if (!ocidResponse.ok) return { ...char, combat_power: 0 };

                            const ocidData = await ocidResponse.json();

                            // ì „íˆ¬ë ¥ ì¡°íšŒ
                            const statUrl = USE_PROXY
                                ? `${API_BASE_URL}/api/maplestory/character/stat?ocid=${ocidData.ocid}&date=${dateString}`
                                : `${DIRECT_API_BASE_URL}/maplestory/v1/character/stat?ocid=${ocidData.ocid}&date=${dateString}`;

                            const statResponse = await fetch(statUrl, {
                                headers: { 'x-nxopen-api-key': apiKey }
                            });

                            if (!statResponse.ok) return { ...char, combat_power: 0 };

                            const statData = await statResponse.json();
                            const combatPowerStat = statData.final_stat?.find(stat => stat.stat_name === 'ì „íˆ¬ë ¥');
                            const combatPower = combatPowerStat ? parseInt(combatPowerStat.stat_value) : 0;

                            return { ...char, combat_power: combatPower };
                        } catch (error) {
                            console.error(`${char.character_name} ì „íˆ¬ë ¥ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                            return { ...char, combat_power: 0 };
                        }
                    });

                    const batchResults = await Promise.all(batchPromises);
                    charactersWithPower.push(...batchResults);

                    // ì§„í–‰ ìƒí™© í‘œì‹œ
                    rankingContainer.innerHTML = `<div class="loading">ì „íˆ¬ë ¥ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘<br><small>${charactersWithPower.length} / 50</small></div>`;
                }

                // 3ë‹¨ê³„: ì „íˆ¬ë ¥ ìˆœìœ¼ë¡œ ì •ë ¬
                charactersWithPower.sort((a, b) => b.combat_power - a.combat_power);

                // 4ë‹¨ê³„: í‘œì‹œ
                displayRanking(charactersWithPower);
            } catch (error) {
                console.error('ìˆœìœ„ ì¡°íšŒ ì˜¤ë¥˜:', error);
                rankingContainer.innerHTML = `
                    <div class="error-message">
                        <strong>ì˜¤ë¥˜ ë°œìƒ</strong><br>
                        ${error.message}
                    </div>
                `;
            } finally {
                rankingBtn.disabled = false;
                rankingBtn.textContent = 'ìˆœìœ„ ì¡°íšŒ';
            }
        }

        // ìˆœìœ„ í‘œì‹œ
        function displayRanking(rankingList) {
            const container = document.getElementById('ranking-container');

            if (!rankingList || rankingList.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ìˆœìœ„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // ìƒìœ„ 50ëª…ë§Œ í‘œì‹œ
            const top50 = rankingList.slice(0, 50);

            let html = `
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th style="width: 80px;">ìˆœìœ„</th>
                            <th>ìºë¦­í„°ëª…</th>
                            <th>ì›”ë“œ</th>
                            <th>ì§ì—…</th>
                            <th>ë ˆë²¨</th>
                            <th>ì „íˆ¬ë ¥</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            top50.forEach((char, index) => {
                const rankClass = index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : '';

                // ì „íˆ¬ë ¥ í‘œì‹œ
                const powerValue = char.combat_power ? char.combat_power.toLocaleString() : '-';

                html += `
                    <tr onclick="searchCharacterFromRanking('${char.character_name}')">
                        <td><span class="rank-number ${rankClass}">${index + 1}</span></td>
                        <td><strong>${char.character_name}</strong></td>
                        <td>${char.world_name || '-'}</td>
                        <td>${char.class_name || char.character_class || '-'}</td>
                        <td>Lv.${char.character_level || 0}</td>
                        <td><strong>${powerValue}</strong></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ìˆœìœ„ì—ì„œ ìºë¦­í„° í´ë¦­ ì‹œ ê²€ìƒ‰
        function searchCharacterFromRanking(characterName) {
            switchTab('search');
            document.getElementById('character-name').value = characterName;
            searchCharacter();
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì¥ë¹„ ë°ì´í„° ì €ì¥
        let currentEquipmentData = null;

        // ì ì¬ëŠ¥ë ¥ ë“±ê¸‰ì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getPotentialGradeClass(grade) {
            if (!grade) return '';
            const gradeLower = grade.toLowerCase();
            if (gradeLower.includes('ë ˆì–´') || gradeLower.includes('rare')) return 'rare';
            if (gradeLower.includes('ì—í”½') || gradeLower.includes('epic')) return 'epic';
            if (gradeLower.includes('ìœ ë‹ˆí¬') || gradeLower.includes('unique')) return 'unique';
            if (gradeLower.includes('ë ˆì „ë“œë¦¬') || gradeLower.includes('legendary')) return 'legendary';
            return '';
        }

        function displayEquipment(equipmentData) {
            if (!equipmentData || !equipmentData.item_equipment || equipmentData.item_equipment.length === 0) {
                return '<div class="no-equipment">ì¥ì°©ëœ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            currentEquipmentData = equipmentData;

            let html = '<div class="equipment-grid">';

            equipmentData.item_equipment.forEach((item, index) => {
                html += `<div class="equipment-item" onclick="showItemDetail(${index})">`;

                // ë¶€ìœ„ í‘œì‹œ
                html += `<div class="equipment-part">${item.item_equipment_part || 'ë¶€ìœ„'}</div>`;

                // ì•„ì´í…œ ì´ë¯¸ì§€
                html += '<div class="equipment-image-container">';
                if (item.item_icon) {
                    html += `<img src="${item.item_icon}" alt="${item.item_name}" class="equipment-image">`;
                } else {
                    html += '<div style="color: #ccc; font-size: 2em;">ğŸ“¦</div>';
                }
                html += '</div>';

                // ì•„ì´í…œ ì´ë¦„
                html += `<div class="equipment-name">${item.item_name || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>`;

                // ë°°ì§€ (ìŠ¤íƒ€í¬ìŠ¤, ì ì¬ëŠ¥ë ¥)
                html += '<div class="equipment-badges">';

                if (item.starforce && item.starforce !== '0') {
                    html += `<div class="equipment-badge starforce">â­ ${item.starforce}ì„±</div>`;
                }

                if (item.potential_option_grade) {
                    const gradeText = item.potential_option_grade;
                    const gradeClass = getPotentialGradeClass(gradeText);
                    html += `<div class="equipment-badge potential ${gradeClass}">ğŸ”® ${gradeText}</div>`;
                }

                if (item.additional_potential_option_grade) {
                    const gradeText = item.additional_potential_option_grade;
                    const gradeClass = getPotentialGradeClass(gradeText);
                    html += `<div class="equipment-badge potential ${gradeClass}">âœ¨ ${gradeText}</div>`;
                }

                html += '</div>';
                html += '</div>';
            });

            html += '</div>';
            return html;
        }

        // ì•„ì´í…œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
        function showItemDetail(itemIndex) {
            if (!currentEquipmentData || !currentEquipmentData.item_equipment[itemIndex]) {
                return;
            }

            const item = currentEquipmentData.item_equipment[itemIndex];
            const modal = document.getElementById('item-modal');
            const modalBody = document.getElementById('modal-body');

            let html = '';

            // í—¤ë”
            html += '<div class="modal-header">';
            html += '<div class="modal-item-image">';
            if (item.item_icon) {
                html += `<img src="${item.item_icon}" alt="${item.item_name}">`;
            } else {
                html += '<div style="color: #ccc; font-size: 3em;">ğŸ“¦</div>';
            }
            html += '</div>';
            html += '<div class="modal-item-title">';
            html += `<div class="modal-item-name">${item.item_name || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>`;
            html += `<div class="modal-item-part">${item.item_equipment_part || 'ë¶€ìœ„'}</div>`;
            html += '</div>';
            html += '</div>';

            // ê°•í™” ì •ë³´
            if (item.starforce || item.scroll_upgrade || item.scroll_upgradeable_count) {
                html += '<div class="modal-section">';
                html += '<div class="modal-section-title">âš¡ ê°•í™” ì •ë³´</div>';
                html += '<div class="modal-enhancement">';
                if (item.starforce && item.starforce !== '0') {
                    html += `<div class="modal-enhancement-item">â­ ìŠ¤íƒ€í¬ìŠ¤ ${item.starforce}ì„±</div>`;
                }
                if (item.scroll_upgrade) {
                    html += `<div class="modal-enhancement-item">ğŸ“œ ì—…ê·¸ë ˆì´ë“œ ${item.scroll_upgrade}íšŒ</div>`;
                }
                if (item.scroll_upgradeable_count) {
                    html += `<div class="modal-enhancement-item">ğŸ”§ ë‚¨ì€ ì—…ê·¸ë ˆì´ë“œ ${item.scroll_upgradeable_count}íšŒ</div>`;
                }
                html += '</div>';
                html += '</div>';
            }

            // ê¸°ë³¸ ìŠ¤íƒ¯
            if (item.item_total_option) {
                const opt = item.item_total_option;
                const hasStats = Object.values(opt).some(val => val && val !== '0');

                if (hasStats) {
                    html += '<div class="modal-section">';
                    html += '<div class="modal-section-title">ğŸ“Š ì•„ì´í…œ ìŠ¤íƒ¯</div>';
                    html += '<div class="modal-stats-grid">';

                    if (opt.str && opt.str !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">STR</span><span class="modal-stat-value">+${opt.str}</span></div>`;
                    if (opt.dex && opt.dex !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">DEX</span><span class="modal-stat-value">+${opt.dex}</span></div>`;
                    if (opt.int && opt.int !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">INT</span><span class="modal-stat-value">+${opt.int}</span></div>`;
                    if (opt.luk && opt.luk !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">LUK</span><span class="modal-stat-value">+${opt.luk}</span></div>`;
                    if (opt.max_hp && opt.max_hp !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ìµœëŒ€ HP</span><span class="modal-stat-value">+${opt.max_hp}</span></div>`;
                    if (opt.max_mp && opt.max_mp !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ìµœëŒ€ MP</span><span class="modal-stat-value">+${opt.max_mp}</span></div>`;
                    if (opt.attack_power && opt.attack_power !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ê³µê²©ë ¥</span><span class="modal-stat-value">+${opt.attack_power}</span></div>`;
                    if (opt.magic_power && opt.magic_power !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ë§ˆë ¥</span><span class="modal-stat-value">+${opt.magic_power}</span></div>`;
                    if (opt.armor && opt.armor !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ë°©ì–´ë ¥</span><span class="modal-stat-value">+${opt.armor}</span></div>`;
                    if (opt.speed && opt.speed !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ì´ë™ì†ë„</span><span class="modal-stat-value">+${opt.speed}</span></div>`;
                    if (opt.jump && opt.jump !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ì í”„ë ¥</span><span class="modal-stat-value">+${opt.jump}</span></div>`;
                    if (opt.boss_damage && opt.boss_damage !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ë³´ìŠ¤ ë°ë¯¸ì§€</span><span class="modal-stat-value">+${opt.boss_damage}%</span></div>`;
                    if (opt.ignore_monster_armor && opt.ignore_monster_armor !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ë°©ì–´ìœ¨ ë¬´ì‹œ</span><span class="modal-stat-value">+${opt.ignore_monster_armor}%</span></div>`;
                    if (opt.all_stat && opt.all_stat !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ì˜¬ìŠ¤íƒ¯</span><span class="modal-stat-value">+${opt.all_stat}%</span></div>`;
                    if (opt.damage && opt.damage !== '0') html += `<div class="modal-stat-item"><span class="modal-stat-label">ë°ë¯¸ì§€</span><span class="modal-stat-value">+${opt.damage}%</span></div>`;

                    html += '</div>';
                    html += '</div>';
                }
            }

            // ì ì¬ëŠ¥ë ¥
            if (item.potential_option_grade || item.potential_option_1 || item.potential_option_2 || item.potential_option_3) {
                html += '<div class="modal-section">';
                html += '<div class="modal-section-title">ğŸ”® ì ì¬ëŠ¥ë ¥</div>';
                if (item.potential_option_grade) {
                    const gradeClass = getPotentialGradeClass(item.potential_option_grade);
                    html += `<div class="modal-potential-grade ${gradeClass}">${item.potential_option_grade}</div>`;
                }
                html += '<div class="modal-potential-list">';
                if (item.potential_option_1) html += `<div class="modal-potential-item">${item.potential_option_1}</div>`;
                if (item.potential_option_2) html += `<div class="modal-potential-item">${item.potential_option_2}</div>`;
                if (item.potential_option_3) html += `<div class="modal-potential-item">${item.potential_option_3}</div>`;
                html += '</div>';
                html += '</div>';
            }

            // ì—ë””ì…”ë„ ì ì¬ëŠ¥ë ¥
            if (item.additional_potential_option_grade || item.additional_potential_option_1 || item.additional_potential_option_2 || item.additional_potential_option_3) {
                html += '<div class="modal-section">';
                html += '<div class="modal-section-title">âœ¨ ì—ë””ì…”ë„ ì ì¬ëŠ¥ë ¥</div>';
                if (item.additional_potential_option_grade) {
                    const gradeClass = getPotentialGradeClass(item.additional_potential_option_grade);
                    html += `<div class="modal-potential-grade ${gradeClass}">${item.additional_potential_option_grade}</div>`;
                }
                html += '<div class="modal-potential-list">';
                if (item.additional_potential_option_1) html += `<div class="modal-potential-item">${item.additional_potential_option_1}</div>`;
                if (item.additional_potential_option_2) html += `<div class="modal-potential-item">${item.additional_potential_option_2}</div>`;
                if (item.additional_potential_option_3) html += `<div class="modal-potential-item">${item.additional_potential_option_3}</div>`;
                html += '</div>';
                html += '</div>';
            }

            // ì†Œìš¸ ì •ë³´
            if (item.soul_name) {
                html += '<div class="modal-section">';
                html += '<div class="modal-section-title">ğŸ‘» ì†Œìš¸</div>';
                html += `<div class="modal-potential-item">${item.soul_name}`;
                if (item.soul_option) html += ` - ${item.soul_option}`;
                html += '</div>';
                html += '</div>';
            }

            modalBody.innerHTML = html;
            modal.classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(event) {
            const modal = document.getElementById('item-modal');
            if (!event || event.target === modal || event.target.classList.contains('modal-close')) {
                modal.classList.remove('active');
            }
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        async function displayCharacterInfo(characterInfo, equipmentData, characterImage, statData) {
            const infoDiv = document.getElementById('character-info');

            if (!characterInfo || !characterInfo.character_name) {
                infoDiv.innerHTML = '<div class="error-message">ìºë¦­í„° ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                infoDiv.classList.add('active');
                return;
            }

            // ì „íˆ¬ë ¥ ì¶”ì¶œ
            let combatPower = 'ì •ë³´ ì—†ìŒ';
            if (statData && statData.final_stat) {
                const combatPowerStat = statData.final_stat.find(stat => stat.stat_name === 'ì „íˆ¬ë ¥');
                if (combatPowerStat) {
                    combatPower = parseInt(combatPowerStat.stat_value).toLocaleString();
                }
            }

            let html = `<h2>ìºë¦­í„° ì •ë³´</h2><div class="character-layout">`;

            // ì™¼ìª½ ì„¹ì…˜ (ì´ë¯¸ì§€ + ê¸°ë³¸ ì •ë³´)
            html += '<div class="character-left-section">';

            // ìºë¦­í„° ì´ë¯¸ì§€
            html += '<div class="character-image-section">';
            if (characterImage) {
                html += `<img src="${characterImage}" alt="${characterInfo.character_name}" class="character-image">`;
            } else {
                html += `
                    <div class="character-image" style="display: flex; align-items: center; justify-content: center; height: 300px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 3em;">
                        ğŸ
                    </div>
                    <p style="margin-top: 10px; color: #999; font-size: 0.9em;">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                `;
            }
            html += '</div>';

            // ê¸°ë³¸ ì •ë³´ (ì´ë¯¸ì§€ ì•„ë˜)
            html += '<div class="character-basic-info">';
            html += '<div class="info-grid">';
            html += `
                <div class="info-item">
                    <div class="info-label">ìºë¦­í„°ëª…</div>
                    <div class="info-value">${characterInfo.character_name || 'ì •ë³´ ì—†ìŒ'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ë ˆë²¨</div>
                    <div class="info-value">Lv.${characterInfo.character_level || 0}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ì§ì—…</div>
                    <div class="info-value">${characterInfo.character_class || 'ì •ë³´ ì—†ìŒ'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ì›”ë“œ</div>
                    <div class="info-value">${characterInfo.world_name || 'ì •ë³´ ì—†ìŒ'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ì „íˆ¬ë ¥</div>
                    <div class="info-value">${combatPower}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ê¸¸ë“œ</div>
                    <div class="info-value">${characterInfo.character_guild_name || 'ê¸¸ë“œ ì—†ìŒ'}</div>
                </div>
            `;
            html += '</div>';
            html += '</div>';
            html += '</div>'; // character-left-section ë‹«ê¸°

            // ì˜¤ë¥¸ìª½ ì„¹ì…˜ (ì¥ë¹„)
            html += `
                <div class="character-details">
                    <div class="equipment-section">
                        <h3>ğŸ’ ì¥ì°© ì•„ì´í…œ</h3>
                        ${displayEquipment(equipmentData)}
                    </div>
                </div>
            `;

            html += '</div>';
            infoDiv.innerHTML = html;
            infoDiv.classList.add('active');
        }

        async function searchCharacter() {
            const apiKey = getApiKey();
            const characterName = document.getElementById('character-name').value.trim();
            const searchBtn = document.getElementById('search-btn');
            const infoDiv = document.getElementById('character-info');

            if (!apiKey) {
                alert('API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'config.html';
                return;
            }

            if (!characterName) {
                alert('ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            searchBtn.disabled = true;
            searchBtn.textContent = 'ê²€ìƒ‰ ì¤‘...';
            infoDiv.innerHTML = '<div class="loading">ìºë¦­í„° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>';
            infoDiv.classList.add('active');

            try {
                const ocid = await getCharacterOcid(characterName, apiKey);
                const characterInfo = await getCharacterBasicInfo(ocid, apiKey);
                const equipmentData = await getCharacterEquipment(ocid, apiKey);
                const characterImage = await getCharacterImage(ocid, apiKey);
                const statData = await getCharacterStat(ocid, apiKey);

                await displayCharacterInfo(characterInfo, equipmentData, characterImage, statData);

                // ê²€ìƒ‰ íšŸìˆ˜ ì¶”ì 
                trackSearch(characterName);
            } catch (error) {
                console.error('ìºë¦­í„° ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                infoDiv.innerHTML = `
                    <div class="error-message">
                        <strong>ì˜¤ë¥˜ ë°œìƒ</strong><br>
                        ${error.message}
                    </div>
                `;
                infoDiv.classList.add('active');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'ê²€ìƒ‰';
            }
        }

        // ìœ íŠœë²„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        let allYoutubers = [];
        let currentCategory = 'all';
        let maxSubscribers = 2000000;

        async function loadYoutubers() {
            try {
                const response = await fetch('youtubers.json');
                allYoutubers = await response.json();
                displayYoutubers();
            } catch (error) {
                console.error('ìœ íŠœë²„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('youtuber-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        ìœ íŠœë²„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
            }
        }

        function updateSubscriberFilter(value) {
            maxSubscribers = parseInt(value);
            const displayValue = maxSubscribers === 0 ? 'ì „ì²´' : `${(maxSubscribers / 10000).toFixed(0)}ë§Œ ì´í•˜`;
            document.getElementById('subscriber-value').textContent = displayValue;
            displayYoutubers();
        }

        function filterYoutubers(category) {
            currentCategory = category;

            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            displayYoutubers();
        }

        function displayYoutubers() {
            const container = document.getElementById('youtuber-container');

            // í•„í„°ë§
            let filtered = allYoutubers.filter(yt => {
                const subscriberMatch = maxSubscribers === 0 || yt.subscribers <= maxSubscribers;
                const categoryMatch = currentCategory === 'all' || yt.category === currentCategory;
                return subscriberMatch && categoryMatch;
            });

            // êµ¬ë…ì ìˆ˜ ê¸°ì¤€ ì •ë ¬
            filtered.sort((a, b) => b.subscribers - a.subscribers);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999; grid-column: 1 / -1;">
                        ì¡°ê±´ì— ë§ëŠ” ìœ íŠœë²„ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }

            let html = '';
            filtered.forEach(yt => {
                const subscriberText = yt.subscribers >= 10000
                    ? `${(yt.subscribers / 10000).toFixed(1)}ë§Œëª…`
                    : `${yt.subscribers.toLocaleString()}ëª…`;

                html += `
                    <div class="youtuber-card" onclick="openYoutubeChannel('${yt.channelId}')">
                        <div class="youtuber-thumbnail">
                            <img src="${yt.thumbnail}" alt="${yt.name}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="youtuber-info">
                            <div class="youtuber-name">${yt.name}</div>
                            <div class="youtuber-subscribers">ğŸ‘¥ êµ¬ë…ì ${subscriberText}</div>
                            <div class="youtuber-category">${yt.category}</div>
                            <div class="youtuber-description">${yt.description}</div>
                            <a href="${yt.channelId.startsWith('@') ? 'https://www.youtube.com/' + yt.channelId : 'https://www.youtube.com/channel/' + yt.channelId}" 
                               target="_blank" 
                               class="youtuber-link"
                               onclick="event.stopPropagation()">
                                ì±„ë„ ë°©ë¬¸í•˜ê¸°
                            </a>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function openYoutubeChannel(channelId) {
            const url = channelId.startsWith('@')
                ? `https://www.youtube.com/${channelId}`
                : `https://www.youtube.com/channel/${channelId}`;
            window.open(url, '_blank');
        }
    </script>
</body>

</html>